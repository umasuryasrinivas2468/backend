{"version":3,"names":["NativeAppEventEmitter","NativeEventEmitter","NativeModules","Platform","version","CFUPIPayment","CFCardPayment","CFCardComponent","LINKING_ERROR","select","ios","default","CashfreePgApi","Proxy","get","Error","CFPaymentGateway","constructor","_defineProperty","emitter","OS","CashfreeEventEmitter","doPayment","checkoutPayment","JSON","stringify","doUPIPayment","doWebPayment","cfSession","doCardPayment","cardPayment","makePayment","getInstalledUpiApps","Promise","resolve","reject","fetchUpiList","apps","console","log","upiAppsSubscription","addListener","cfPayment","paymentData","doElementUPIPayment","setEventSubscriber","cfEventCallback","eventFunction","event","data","parse","onReceivedEvent","eventName","meta","eventSubscription","removeEventSubscriber","undefined","remove","setCallback","cfCallback","successFunction","orderID","onVerify","failureFunction","error","response","CFErrorResponse","message","fromJSON","onError","successSubscription","failureSubscription","removeCallback","errorString","object","status","code","type","getStatus","getMessage","getCode","getType","CFCard","CFPaymentGatewayService"],"sources":["index.ts"],"sourcesContent":["import {\n  EmitterSubscription,\n  EventEmitter,\n  NativeAppEventEmitter,\n  NativeEventEmitter,\n  NativeModules,\n  Platform,\n} from 'react-native';\nimport { version } from '../package.json';\nimport { type CheckoutPayment, type CFSession, CFUPIPayment, CFCardPayment } from 'cashfree-pg-api-contract';\nimport CFCardComponent from './Card/CFCardComponent';\n\nconst LINKING_ERROR =\n  `The package 'react-native-cashfree-pg-api' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: '- You have run \\'pod install\\'\\n', default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst CashfreePgApi = NativeModules.CashfreePgApi\n  ? NativeModules.CashfreePgApi\n  : new Proxy(\n    {},\n    {\n      get() {\n        throw new Error(LINKING_ERROR);\n      },\n    },\n  );\n\nclass CFPaymentGateway {\n  private emitter: EventEmitter;\n  private successSubscription: EmitterSubscription | null = null;\n  private failureSubscription: EmitterSubscription | null = null;\n  private eventSubscription: EmitterSubscription | null = null;\n  private upiAppsSubscription: EmitterSubscription | null = null;\n\n  constructor() {\n    this.emitter =\n      Platform.OS === 'ios'\n        ? new NativeEventEmitter(NativeModules.CashfreeEventEmitter)\n        : NativeAppEventEmitter;\n  }\n\n  doPayment(checkoutPayment: CheckoutPayment) {\n    checkoutPayment.version = version;\n    CashfreePgApi.doPayment(JSON.stringify(checkoutPayment));\n  }\n\n  doUPIPayment(checkoutPayment: CheckoutPayment) {\n    checkoutPayment.version = version;\n    CashfreePgApi.doUPIPayment(JSON.stringify(checkoutPayment));\n  }\n\n  doWebPayment(cfSession: CFSession) {\n    CashfreePgApi.doWebPayment(JSON.stringify(cfSession));\n  }\n\n  /**\n   * @deprecated : Instead call makePayment\n   */\n  doCardPayment(cardPayment: CheckoutPayment) {\n    this.makePayment(cardPayment);\n  }\n\n  async getInstalledUpiApps() {\n    return new Promise((resolve, reject) => {\n      if(Platform.OS === 'ios'){\n        let fetchUpiList = (apps: string) => {\n          console.log(JSON.stringify(apps));\n          if (apps) {\n            resolve(apps);\n          } else {\n            reject('No UPI apps found');\n          }\n        };\n        this.upiAppsSubscription = this.emitter.addListener('cfUpiApps', fetchUpiList);\n        CashfreePgApi.getInstalledUpiApps()\n      }\n      else {\n        CashfreePgApi.getInstalledUpiApps((apps: string) => {\n          if (apps) {\n            resolve(apps);\n          } else {\n            reject('No UPI apps found');\n          }\n        });\n      }\n    });\n  }\n\n  makePayment(cfPayment: CheckoutPayment) {\n    cfPayment.version = version;\n    const paymentData = JSON.stringify(cfPayment);\n    if (cfPayment instanceof CFUPIPayment) {\n      CashfreePgApi.doElementUPIPayment(paymentData);\n    } else if (cfPayment instanceof CFCardPayment) {\n      CashfreePgApi.doCardPayment(paymentData);\n    } else {\n      console.log('makePayment::==> Wrong payment object');\n    }\n  }\n\n  setEventSubscriber(cfEventCallback: CFEventCallback) {\n    let eventFunction = (event: string) => {\n      console.log(JSON.stringify(event));\n      let data = JSON.parse(event);\n      cfEventCallback.onReceivedEvent(data.eventName, data.meta);\n    };\n    this.eventSubscription = this.emitter.addListener('cfEvent', eventFunction);\n    CashfreePgApi.setEventSubscriber();\n  }\n\n  removeEventSubscriber() {\n    if (\n      this.eventSubscription !== undefined &&\n      this.eventSubscription !== null\n    ) {\n      this.eventSubscription.remove();\n      this.eventSubscription = null;\n    }\n    CashfreePgApi.removeEventSubscriber();\n  }\n\n  setCallback(cfCallback: CFCallback) {\n    // this.cfCallback = cfCallback;\n    let successFunction = (orderID: string) => {\n      console.log('response is : ' + JSON.stringify(orderID));\n      cfCallback.onVerify(orderID);\n    };\n    let failureFunction = (error: string) => {\n      console.log('reason: ' + JSON.stringify(error));\n      const response = new CFErrorResponse();\n      // @ts-ignore\n      const message = JSON.parse(error);\n      response.fromJSON(message.error);\n      // @ts-ignore\n      cfCallback.onError(response, message.orderID);\n    };\n    this.successSubscription = this.emitter.addListener(\n      'cfSuccess',\n      successFunction,\n    );\n    this.failureSubscription = this.emitter.addListener(\n      'cfFailure',\n      failureFunction,\n    );\n    CashfreePgApi.setCallback();\n  }\n\n  removeCallback() {\n    if (\n      this.successSubscription !== undefined &&\n      this.successSubscription !== null\n    ) {\n      this.successSubscription.remove();\n      this.successSubscription = null;\n    }\n    if (\n      this.failureSubscription !== undefined &&\n      this.failureSubscription !== null\n    ) {\n      this.failureSubscription.remove();\n      this.failureSubscription = null;\n    }\n    if (\n      this.upiAppsSubscription !== undefined &&\n      this.upiAppsSubscription !== null\n    ) {\n      this.upiAppsSubscription.remove();\n      this.upiAppsSubscription = null;\n    }\n  }\n}\n\nexport interface CFCallback {\n  onVerify(orderID: string): void;\n\n  onError(error: CFErrorResponse, orderID: string): void;\n}\n\nexport interface CFEventCallback {\n  onReceivedEvent(eventName: string, map: Map<string, string>): void;\n}\n\nexport class CFErrorResponse {\n  private status: string = 'FAILED';\n  private message: string = 'payment has failed';\n  private code: string = 'payment_failed';\n  private type: string = 'request_failed';\n\n  fromJSON(errorString: string) {\n    console.log('errorString :' + errorString);\n    const object = JSON.parse(errorString);\n    console.log('errorStringObject :' + object);\n    this.status = object.status;\n    this.message = object.message;\n    this.code = object.code;\n    this.type = object.type;\n  }\n\n  getStatus(): string {\n    return this.status;\n  }\n\n  getMessage(): string {\n    return this.message;\n  }\n\n  getCode(): string {\n    return this.code;\n  }\n\n  getType(): string {\n    return this.type;\n  }\n}\n\nexport const CFCard = CFCardComponent\nexport const CFPaymentGatewayService = new CFPaymentGateway();\n"],"mappings":"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","ignoreList":[]}